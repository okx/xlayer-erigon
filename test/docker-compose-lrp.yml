version: "3.5"
networks:
  default:
    name: erigon-lrp
services:
  xlayer-lrp:
    container_name: xlayer-lrp
    image: cdk-erigon
    environment:
      - CDK_ERIGON_SEQUENCER=0
    ports:
      - 6062:6060
      - 8126:8545
      - 6902:6900
      - 9093:9095
    volumes:
      - ./data/lrp/:/home/erigon/data/
      - ./config/test.erigon.rpc.config.yaml:/usr/src/app/config.yaml
      - ./config/dynamic-mynetwork-allocs.json:/usr/src/app/dynamic-mynetwork-allocs.json
      - ./config/dynamic-mynetwork-chainspec.json:/usr/src/app/dynamic-mynetwork-chainspec.json
      - ./config/dynamic-mynetwork-conf.json:/usr/src/app/dynamic-mynetwork-conf.json
    command: >
      cdk-erigon --http.vhosts=* --http.corsdomain=* --ws --config=/usr/src/app/config.yaml

  xlayer-lrp-unwind:
    container_name: xlayer-lrp-unwind
    image: cdk-erigon
    environment:
      - CDK_ERIGON_SEQUENCER=0
    volumes:
      - ./data/lrp/:/home/erigon/data/
      - ./config/test.erigon.rpc.config.yaml:/usr/src/app/config.yaml
      - ./config/dynamic-mynetwork-allocs.json:/usr/src/app/dynamic-mynetwork-allocs.json
      - ./config/dynamic-mynetwork-chainspec.json:/usr/src/app/dynamic-mynetwork-chainspec.json
      - ./config/dynamic-mynetwork-conf.json:/usr/src/app/dynamic-mynetwork-conf.json
    command: |
      integration state_stages_zkevm \
        --config=/usr/src/app/config.yaml \
        --chain dynamic-mynetwork \
        --datadir /home/erigon/data/ \
        --unwind-batch-no=136799

  xlayer-lrp-resequence:
    container_name: xlayer-lrp-resequence
    image: cdk-erigon
    environment:
      - CDK_ERIGON_SEQUENCER=1
    ports:
      - 6062:6060
      - 8126:8545
      - 6902:6900
      - 9093:9095
    volumes:
      - ./data/lrp/:/home/erigon/data/
      - ./config/test.erigon.seq.config.yaml:/usr/src/app/config.yaml
      - ./config/dynamic-mynetwork-allocs.json:/usr/src/app/dynamic-mynetwork-allocs.json
      - ./config/dynamic-mynetwork-chainspec.json:/usr/src/app/dynamic-mynetwork-chainspec.json
      - ./config/dynamic-mynetwork-conf.json:/usr/src/app/dynamic-mynetwork-conf.json
    command: >
      cdk-erigon --zkevm.l1-cache-enabled=true --zkevm.sequencer-resequence=true --zkevm.sequencer-resequence-halt-on-batch-number=136911 --http.vhosts=* --http.corsdomain=* --ws --config=/usr/src/app/config.yaml

  xlayer-mainnet-lrp-unwind:
    container_name: xlayer-mainnet-lrp-unwind
    image: cdk-erigon
    environment:
      - CDK_ERIGON_SEQUENCER=0
    volumes:
      - ./mainnet/seq/:/home/erigon/data/
      - ./config/xlayerconfig-mainnet.yaml:/usr/src/app/config.yaml
    command: |
      integration state_stages_zkevm \
        --config=/usr/src/app/config.yaml \
        --chain xlayer-mainnet \
        --datadir /home/erigon/data/ \
        --unwind-batch-no=136799

  xlayer-mainnet-lrp-resequence:
    container_name: xlayer-mainnet-lrp-resequence
    image: cdk-erigon
    environment:
      - CDK_ERIGON_SEQUENCER=1
    ports:
      - 6060:6060
      - 8126:8545
      - 6902:6900
      - 9093:9095
    volumes:
      - ./mainnet/seq:/home/erigon/data/
      - ./config/xlayerconfig-mainnet.yaml:/usr/src/app/config.yaml
    command: >
      cdk-erigon --zkevm.sequencer-resequence=true --zkevm.sequencer-resequence-halt-on-batch-number=134525 --http.vhosts=* --http.corsdomain=* --ws --config=/usr/src/app/config.yaml

  xlayer-executor:
    container_name: xlayer-executor
    image: hermeznetwork/zkevm-prover:v9.0.0-RC1-fork.13
    platform: linux/amd64
    environment:
      - EXPERIMENTAL_DOCKER_DESKTOP_FORCE_QEMU=1
    ports:
      - 0.0.0.0:50061:50061 # MT
      - 0.0.0.0:50071:50071 # Executor
    volumes:
      - ./config/test.stateless_executor.config.json:/usr/src/app/config.json
    command: >
      zkProver -c /usr/src/app/config.json

  xlayer-mock-l1-network:
    container_name: xlayer-mock-l1-network
    image: zjg555543/geth:fork13-v0.0.3
    ports:
      - 8545:8545
      - 8546:8546
    command:
      - "--http"
      - "--http.api"
      - "admin,eth,debug,miner,net,txpool,personal,web3"
      - "--http.addr"
      - "0.0.0.0"
      - "--http.corsdomain"
      - "*"
      - "--http.vhosts"
      - "*"
      - "--ws"
      - "--ws.origins"
      - "*"
      - "--ws.addr"
      - "0.0.0.0"
      - "--dev"
      - "--dev.period"
      - "1"
      - "--datadir"
      - "/geth_data"
      - "--syncmode"
      - "full"
      - "--rpc.allow-unprotected-txs"